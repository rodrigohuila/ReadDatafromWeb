const puppeteer = require("puppeteer");
const fs = require("fs");

const path = "blsFinal.txt";
const url = "https://argosweb.tcbuen.com/Account/Login.aspx";
const USER = "ISAMOS";
const PASS = "TCBUEN2023";
var resultFinal = [];

const BLs1 = ["219485844", "1KT650111"];

const BLs = [
  "SUDUB2SCL021899X",
  "SUDU82SSN001302A",
  "220138279",
  "SUDU22PHL034760A",
  "220594089",
  "599866481",
  "220594542",
  "YMLUC240058425",
  "914635115",
  "599866505",
  "R05092298",
  "YMLUL971005635",
  "SHTM20123100",
  "067CX14356",
  "1KT655495",
  "031C560384",
  "221062669",
  "221067889",
  "SHSE20859900",
  "220822605",
  "034C535791",
  "SUDUN2KSZ012725A",
  "220763099",
  "219748058",
  "221851021",
  "221063096",
  "217485492",
  "220678145",
  "609199688",
  "189CX04336",
  "220860558",
  "220923230",
  "024C545643",
  "SHSI20059800",
  "220935456",
  "027C626128",
  "220765702",
  "YMLUC232098917",
  "YMLUC240058328",
  "YMLUC232099056",
  "609224542",
  "024C545326",
  "027C615178",
  "027C625423",
  "031C560545",
  "267944356",
  "220739902",
  "221302163",
  "1KT660147",
  "220921770",
  "024C543364",
  "NGZF20478200",
  "1KT662788",
  "221344894",
  "189CX04767",
  "220866937",
  "221436258",
  "221290673",
  "221188277",
  "SHPL20296000",
  "SEL200162200",
  "914611361",
  "SEL200162100",
  "221509447",
  "914601220",
  "SHSE20866600",
  "1KT662772",
  "YMLUC236099569",
  "220600079",
  "221161188",
  "914601167",
  "221188285",
  "221378869",
  "R05092310",
  "005CX28043",
  "240810843",
  "SHWL20571100",
  "034C530268",
  "031C557766",
  "221125456",
  "031C560547",
  "132C509676",
  "SUDU22MGA001706A",
  "142C508308",
  "220865523",
  "220664718",
  "031C560383",
  "221344871",
  "YMLUC232099050",
  "220820845",
  "220921465",
  "031C560540",
  "142C508178",
  "024C546870",
  "035CX51745",
  "1KT657412",
  "YMLUL971005743",
  "220802717",
  "024C540051",
  "220820576",
  "220912229",
  "1KT655079",
  "221098588",
  "220467959",
  "220815739",
  "YMLUL971005870",
  "YMLUL971005871",
  "220821772",
  "100CX18491",
  "914604313",
  "220820917",
  "034C536814",
  "034C536810",
  "034C539503",
  "025C727647",
  "034C536816",
  "024C541039",
  "220821032",
  "032CA00526",
  "SHOT20402200",
  "SUDUB2SCL021390X",
  "025C720059",
  "024C546994",
  "1KT646647",
  "SHOT20406500",
  "032CA00539",
  "220458940",
  "NKAE20051400",
  "220815131",
  "220882783",
  "YMLUC240058180",
  "SHSE20765700",
  "220815170",
  "035CX52628",
  "221223750",
  "220815012",
  "027C612331",
  "005CX28964",
  "151C503926",
  "221030991",
  "YMLUC236099261",
  "220761968",
  "151C503925",
  "221313460",
  "220986981",
  "167CA02371",
  "221441517",
  "220683305",
  "024C539891",
  "SHOT20402100",
  "221029167",
  "MEX200058400",
  "040CX10492",
  "YMLUC360710169",
  "219812560",
  "142C508246",
  "024C541047",
  "221027965",
  "024C544823",
  "024C546712",
  "220921619",
  "YMLUC236099098",
  "MEX200058200",
  "220837676",
  "220837591",
  "MEX200058300",
  "220501508",
  "SUDUB2SCL021335X",
  "NGZF22651100",
  "220705258",
  "220865463",
  "221025472",
  "220921544",
  "1KT650173",
  "035CX56935",
  "024C543068",
  "024C543091",
  "024C546996",
  "024C547016",
  "YMLUL971005682",
  "220922800",
  "1KT650182",
  "291812861",
  "SUDU62SSZ051221X",
  "031C559368",
  "1KT665572",
  "220646881",
  "SUDUB2LIM013711A",
  "220931527",
  "025C715606",
  "221022209",
  "SUDUB2SCL021784X",
  "221022197",
  "MEX200050000",
  "034C537134",
  "NGTF20182100",
  "025C713710",
  "024C541037",
  "024C543087",
  "024C546013",
  "024C546008",
  "024C546014",
  "024C546990",
  "024C546872",
  "220978005",
  "024C539875",
  "220922017",
  "220991281",
  "220921559",
  "025C728949",
  "220998686",
  "132CA00384",
  "220566108",
  "050CA04288",
  "220815075",
  "NGZF22613200",
  "220815057",
  "034C538370",
  "220282387",
  "220441233",
  "220922114",
  "SUDUN2BLD000970A",
  "024C539822",
  "1KT553961",
  "142C507553",
  "1KT655209",
  "220954756",
  "220761806",
  "024C541683",
  "221295129",
  "SUDU22PHL034003A",
  "221051088",
  "024C539865",
  "220921968",
  "220956080",
  "220900053",
  "1KT658997",
  "YMLUC240058209",
  "220881620",
  "220921617",
  "031C558373",
  "031C560539",
  "830248134",
  "221043466",
  "220661515",
  "1KT663911",
  "221022189",
  "034C535529",
  "YMLUC239050471",
  "220956176",
  "220921450",
  "024C543102",
  "SHRS20014600",
  "025C716794",
  "220922244",
  "SUDU62SSZ054546X",
  "SUDU22BLB001477A",
  "221094708",
  "100CX18490",
  "025C712225",
  "024C540176",
  "027C616083",
  "219993906",
  "1KT641380",
  "SUDU22MEX015681A",
  "220151810",
  "YMLUC240058178",
  "132CA00375",
  "220741826",
  "R05092321",
  "034C535611",
  "1KT660229",
  "220679979",
  "031C556535",
  "SUDU22MEX015773A",
  "NGIC20913000",
  "914458356",
  "220984468",
  "024C541041",
  "220762233",
  "179CA00564",
  "179CA00558",
  "830249252",
  "YMLUC240058134",
  "221086691",
  "1KT655931",
  "220386928",
  "179CA00562",
  "179CA00563",
  "219838909",
  "179CA00561",
  "SHOT20391800",
  "179CA00560",
  "220955228",
  "SHOT20383200",
  "034C535175",
  "TAWX20368900",
  "221059206",
  "YMLUC240058192",
  "031C557471",
  "025C712218",
  "170CA07344",
  "220838257",
  "220556935",
  "220879905",
  "220838258",
  "220924228",
  "220865370",
  "220184238",
  "179CA00559",
  "221408177",
  "025C721234",
  "MEX200050800",
  "220962627",
  "039CX45250",
  "R05092308",
  "220962261",
  "221015937",
  "914373638",
  "025C712213",
  "1KT646484",
  "034C535181",
  "YMLUC236099099",
  "034C536815",
  "1KT665020",
  "221025448",
  "220502130",
  "220815763",
  "024C540312",
  "220921453",
  "024C540181",
  "221213899",
  "034C535465",
  "031C556543",
  "024C542616",
  "221105667",
  "1KT650251",
  "024C543363",
  "NGPN20737000",
  "151C503927",
  "220956118",
  "221060106",
  "609161788",
  "025C719521",
  "914501576",
  "220657008",
  "221410178",
  "1KT666032",
  "SUDUN2SOL008463A",
  "220902841",
  "220984493",
  "220991094",
  "220932906",
  "YMLUC232098698",
  "R04994704",
  "291812860",
  "031C556544",
  "220944431",
  "100CX14076",
  "SUDU22MEX015249A",
  "1KT657376",
  "220921479",
  "167CA02292",
  "914545457",
  "220921406",
  "1KT657268",
  "1KT621548",
  "025C716516",
  "167CA02274",
  "220403683",
  "025C719514",
  "220740962",
  "220921415",
  "221038014",
  "024C540446",
  "025C716514",
  "024C539862",
  "067CX18012",
  "220951643",
  "024C542617",
  "220821068",
  "1KT652855",
  "220928011",
  "220018813",
  "SUDU62SSZ054540X",
  "SUDUN2KUL000996X",
  "KNSZXI012",
  "220990932",
  "024C541036",
  "220656688",
  "1KT655264",
  "SUDU22MEX014100A",
  "1KT652846",
  "024C541042",
  "220120637",
  "034C537158",
  "024C545805",
  "NGZF22649700",
  "220820212",
  "NGZF22649800",
  "221176724",
  "NGZF22649600",
  "292813144",
  "221029486",
  "SUDUN2NGB017224A",
  "220921615",
  "YMLUC236099330",
  "YMLUL971005794",
  "167CA02304",
  "914484521",
  "024C539900",
  "221022198",
  "132CA00368",
  "1KT650183",
  "220925482",
  "SUDU62SSZ054543X",
  "KNSZXH810",
  "132CA00367",
  "914567628",
  "609213160",
  "221064078",
  "220865252",
  "024C539864",
  "025C714090",
  "034C538371",
  "220999183",
  "1KT650185",
  "024C535431",
  "SUDUB2SCL021433X",
  "031C556542",
  "220871453",
  "220986805",
  "035CX51909",
  "115C508933",
  "SUDUB2SCL020550X",
  "609182839",
  "034C536321",
  "132CA00360",
  "SUDUN2KUL001067X",
  "220912271",
  "220957267",
  "220499769",
  "221036711",
  "221062492",
  "1KT617684",
  "220918701",
  "1KT662436",
  "025C714083",
  "027C612336",
  "024C541900",
  "220821005",
  "034C536308",
  "025C719829",
  "220831927",
  "SUDUN2KUL000973X",
  "167CA02287",
  "034C537160",
  "TAWX20366300",
  "221065796",
  "YMLUC240058240",
  "KNSZXI013",
  "220128426",
  "220568417",
  "KNSZXH983",
  "914548809",
  "914558837",
  "914558833",
  "914558831",
  "914558806",
  "914548808",
  "221311462",
  "1KT660558",
  "1KT659887",
  "220820309",
  "167CA02277",
  "035CX52634",
  "YMLUC236099220",
  "220441700",
  "219994067",
  "1KT667361",
  "221222521",
  "YMLUC240058257",
  "221103448",
  "220921710",
  "025C715620",
  "220762048",
  "220740294",
  "025C719516",
  "220333189",
  "SUDUN2NGB017225A",
  "220921520",
  "035CX52631",
  "221144011",
  "292628196",
  "220909195",
  "914548812",
  "221027776",
  "914548780",
  "220775519",
  "220928467",
  "221139046",
  "SUDUN2NGB017613A",
  "SUDUN2NGB017643A",
  "221039021",
  "221031109",
  "220930789",
  "034C536272",
  "YMLUC240058265",
  "031C556545",
  "SUDUN2SOL008233A",
  "221066855",
  "031C556541",
  "220733845",
  "142C507268",
  "132CA00364",
  "142C507501",
  "220924281",
  "1KT657345",
  "034C537220",
  "220761173",
  "220661520",
  "220762864",
  "1KT660912",
  "221072072",
  "024C535618",
  "TAWX20368800",
  "031C556538",
  "220957058",
  "221029273",
  "220865317",
  "219964212",
  "220922989",
  "034C535613",
  "SHBV20264500",
  "TAWX20369000",
  "914548959",
  "220775466",
  "220924753",
  "221061866",
  "220820707",
  "SUDUN2KOS000190A",
  "221025217",
  "024C543912",
  "SUDUB2LIM013939A",
  "025C716084",
  "221031514",
  "031C557143",
  "221060101",
  "220600276",
  "221032156",
  "220922996",
  "1KT650309",
  "220922138",
  "220820997",
  "YMLUC240058283",
  "219477110",
  "189CX04333",
  "SHBV20263700",
  "SHRS20015400",
  "220145457",
  "1KT636614",
  "SUDUN2SHA019168A",
  "914501336",
  "032CA00502",
  "220499667",
  "031C556537",
  "SUDU72BCN002629X",
  "1KT657269",
  "NGNB20545000",
  "YMLUC240058083",
  "220921720",
  "220234796",
  "TAWX20365000",
  "220301969",
  "220461908",
  "034C535612",
  "219660913",
  "221186800",
  "SUDUN2TSN007164A",
  "031C556539",
  "1KT657411",
  "221029990",
  "1KT650037",
  "220732661",
  "220963653",
  "1KT657233",
  "031C556534",
  "034C537161",
  "YMLUC232098606",
  "219866647",
  "220325658",
  "189CX04332",
  "219801073",
  "220730582",
  "220390346",
  "1KT657368",
  "220335699",
  "167CA02229",
  "1KT657350",
  "1KT661759",
  "1KT643549",
  "041CX03505",
  "034C537159",
  "221167089",
  "292874263",
  "221001874",
  "220405542",
  "220895558",
  "220787608",
  "220874852",
  "MEX200048500",
  "220731429",
  "220866426",
  "220961965",
  "220928543",
  "1KT652809",
  "167CA02160",
  "167CA02162",
  "167CA02166",
  "220390415",
  "167CA02228",
  "167CA02227",
  "1KT652903",
  "167CA02164",
  "221735825",
  "NGZF22671600",
  "219179861",
  "1KT658153",
  "1KT655170",
  "1KT657409",
  "220988613",
  "220961955",
  "024C543066",
  "024C541045",
  "SUDUB2SCL020796X",
  "024C541685",
  "219971082",
  "024C540178",
  "024C539929",
  "025C714085",
  "025C717268",
  "024C539833",
  "SUDU62SSZ056585X",
  "220923293",
  "221000887",
  "220923266",
  "609178191",
  "1KT662612",
  "914555481",
  "220866926",
  "221066858",
  "220821200",
  "220821510",
  "SUDU52MVD005865X",
  "220928404",
  "220922691",
  "220820634",
  "220762425",
  "220117881",
  "220661321",
  "219718036",
  "221286919",
  "221023902",
  "220574901",
  "1KT643554",
  "240809037",
  "219810073",
  "219844781",
  "031C552431",
  "219435658",
  "SHBV20264700",
  "220921793",
  "220514248",
  "221018735",
  "220761615",
  "032CA00515",
  "609161818",
  "220761650",
  "YMLUC232098539",
  "221045751",
  "220403056",
  "220815904",
  "221095673",
  "218841160",
  "221087091",
  "219243439",
  "914548970",
  "220984653",
  "914594244",
  "SEL200139800",
  "220797557",
  "MEX200048400",
  "220881419",
  "YMLUC240058157",
  "220923291",
  "SUDU22PHL027661A",
  "SUDUN2BLD000938A",
  "220985421",
  "SUDU62SSZ055834X",
  "SUDUB2SCL020040X",
  "SUDUN2NGB017006A",
  "SUDU62SSZ051222X",
  "221040136",
  "220921572",
  "914592021",
  "SUDU62SSZ051901X",
  "220925280",
  "220866257",
  "SUDU22JAX027131A",
  "220363407",
  "SUDU72BCN003063X",
  "220921310",
  "220600311",
  "220820823",
  "220762474",
  "220703911",
  "SUDU62SSZ049993X",
  "220921648",
  "YMLUC232098780",
  "221410185",
  "YMLUC240057993",
  "1KT664278",
  "220595490",
  "268038066",
  "220652518",
  "220921540",
  "1KT652841",
  "220761717",
  "MEX200048300",
  "220925055",
  "YMLUC236099031",
  "221256538",
  "SUDUB2SCL019207X",
  "221028544",
  "YMLUC232098716",
  "220885393",
  "YMLUC232098587",
  "221222615",
  "220919166",
  "034C535718",
  "220597196",
  "SUDUB2SCL020544X",
  "YMLUC236099046",
  "SHRS20015600",
  "025C721785",
  "220737422",
  "220820602",
  "218575305",
  "220922446",
  "221234010",
  "220924028",
  "219983648",
  "167CA02257",
  "220575274",
  "291850191",
  "220502359",
  "220923125",
  "221025066",
  "YMLUC236099102",
  "220921488",
  "220869989",
  "220512037",
  "1KT643682",
  "291850190",
  "914353308",
  "221041934",
  "027C616081",
  "MEX200048200",
  "221092773",
  "220921557",
  "220954841",
  "220733603",
  "YMLUC232098685",
  "220921521",
  "220418571",
  "220483165",
  "YMLUC236099164",
  "220921751",
  "167CA02226",
  "221025586",
  "220922424",
  "220761658",
  "219886611",
  "NGJH20145500",
  "221068865",
  "SEL200158300",
  "914511882",
  "1KT661963",
  "220922690",
  "219976256",
  "YMLUL971005786",
  "220998578",
  "220762848",
  "220881999",
  "220702907",
  "SUDUB2SCL0190861",
  "219784894",
  "220921485",
  "1KT641271",
  "220923013",
  "220015579",
  "SHPL20303400",
  "221094672",
  "1KT655510",
  "220184011",
  "220743718",
  "1KT650168",
  "220918433",
  "221030911",
  "220925130",
  "NPOS24276",
  "914541082",
  "221030576",
  "914555479",
  "221074020",
  "221031422",
];

(async () => {
  const browser = await puppeteer.launch({
    headless: false,
    ignoreDefaultArgs: ["--disable-extensions"],
    args: ["–start-fullscreen"],
  });
  //Go to URL
  let page = await browser.newPage();
  await page.goto(url, {
    waitUntil: "networkidle0",
  });
  //Input User
  await page.type(
    "#ctl00_ctl00_ASPxSplitter1_Content_MainContent_tbUserName_ET",
    USER,
    { delay: 100 }
  );
  //Input Pass
  await page.type(
    "td.dxic #ctl00_ctl00_ASPxSplitter1_Content_MainContent_tbPassword_I_CLND",
    PASS,
    { delay: 100 }
  );
  //Clic Login
  await page.click(
    "div.dxbButton_Metropolis.login.login-submit.dxbButtonSys.dxbTSys"
  );
  // Go TO Page for BLs
  await page.goto("https://argosweb.tcbuen.com/ConsultaBLCOS.aspx", {
    waitUntil: "networkidle0",
  });

  //FOR EACH BLs
  for (let i = 0; i < BLs.length; i++) {
    //Clic on search button if reload doestn´t work in order to clean
    await page.click("#ctl00_ASPxSplitter1_Content_ctl00_ASPxTxtBL_I", {
      waitUntil: "networkidle0",
      clickCount: 3,
    });
    // Writte BL
    await page.type("#ctl00_ASPxSplitter1_Content_ctl00_ASPxTxtBL_I", BLs[i], {
      delay: 35,
      waitUntil: "networkidle0",
    });
    //Clic on search button
    await page.click(
      "div #ctl00_ASPxSplitter1_Content_ctl00_ASPxButtonBuscar_CD.dxb",
      {
        waitUntil: "networkidle0",
      }
    );
    //Wait for page load the page with new info
    await page.waitForNavigation({
      waitUntil: "networkidle0",
    });

    //Read data of BLs testContent or innerHTML
    const result = await page
      .evaluate(
        () => {
          return Array.from(document.querySelectorAll("td.dx-wrap.dxgv")).map(
            (el) => el.textContent
          );
        },
        { waitUntil: "networkidle0" }
      )
      .catch((err) => console.log("error loading url", err));

    //Loop the new array in order to extract only the datatext
    await result.forEach((element) => {
      resultFinal.push({
        Item: i + 1,
        "BL buscado": BLs[i],
        data: element.toString().trim(),
      });
    });

    //ScreenShoot
    await page.screenshot({
      path: `BLS\/${BLs[i]}.png`,
    });

    //console.log(resultFinal);
    fs.writeFile(path, JSON.stringify(resultFinal), "utf8", function (err) {
      if (err) {
        return console.log(err);
      }
      console.log(`The bl No ${i} was saved!`);
    });

    //Reload page to clean
    //await page.reload();
  }
  await browser.close();
})();
